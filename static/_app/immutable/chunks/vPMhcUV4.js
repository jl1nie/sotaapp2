import{h as l}from"./CltlFA8S.js";import{w as f}from"./UMrgX0BC.js";function m(s,e,a){var t=s==null?"":""+s;return t===""?null:t}function p(s,e,a,t,r,n){var o=s.__className;if(l||o!==a||o===void 0){var u=m(a);(!l||u!==s.getAttribute("class"))&&(u==null?s.removeAttribute("class"):e?s.className=u:s.setAttribute("class",u)),s.__className=a}return n}function g(){const{subscribe:s,set:e,update:a}=f({token:null,email:null,isAuthenticated:!1,loading:!0});return{subscribe:s,init:()=>{const t=localStorage.getItem("authToken"),r=localStorage.getItem("authEmail");e(t?{token:t,email:r,isAuthenticated:!0,loading:!1}:{token:null,email:null,isAuthenticated:!1,loading:!1})},login:async(t,r)=>{try{const n=await fetch("/api/v2/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})});if(!n.ok)return{success:!1,error:"Invalid email or password"};const o=n.headers.get("Authorization");return o?(localStorage.setItem("authToken",o),localStorage.setItem("authEmail",t),e({token:o,email:t,isAuthenticated:!0,loading:!1}),{success:!0}):{success:!1,error:"No authorization token received"}}catch{return{success:!1,error:"Network error. Please try again."}}},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("authEmail"),e({token:null,email:null,isAuthenticated:!1,loading:!1})},getToken:()=>localStorage.getItem("authToken")}}const c=g();async function i(s,e){const a=c.getToken();if(!a)return{success:!1,message:"認証されていません"};const t=new FormData;t.append("file",e);try{const r=await fetch(s,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:t});if(r.status===401||r.status===403)return c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"};let n;try{n=await r.json()}catch{return r.ok?{success:!0,message:"アップロード成功！"}:{success:!1,message:`アップロードに失敗しました: ${r.status} ${r.statusText}`}}return n.success?{success:!0,message:n.message||`インポート完了: ${n.imported??0}件追加`,imported:n.imported,skipped:n.skipped}:{success:!1,message:n.message||"アップロードに失敗しました",code:n.code}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function k(s){return i("/api/v2/pota/import",s)}async function y(s){return i("/api/v2/sota/import/ja",s)}async function w(s){return i("/api/v2/locator/jcc-jcg/import",s)}async function T(){const s=c.getToken();if(!s)return{success:!1,message:"認証されていません"};try{const e=await fetch("/api/v2/admin/metrics",{method:"GET",headers:{Authorization:`Bearer ${s}`}});return e.status===401||e.status===403?(c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):e.ok?{success:!0,data:await e.json()}:{success:!1,message:`メトリクス取得に失敗しました: ${e.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function v(){const s=c.getToken();if(!s)return{success:!1,message:"認証されていません"};try{const e=await fetch("/api/v2/admin/restart",{method:"POST",headers:{Authorization:`Bearer ${s}`}});return e.status===401||e.status===403?(c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):e.ok?{success:!0,message:"サーバーをリスタートしています..."}:{success:!1,message:`リスタートに失敗しました: ${e.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function S(s,e="strict"){const a=new FormData;a.append("file",s);try{const t=await fetch(`/api/v2/sota/award/10th-anniversary/judge?mode=${e}`,{method:"POST",body:a});return t.ok?{success:!0,result:await t.json()}:{success:!1,message:(await t.json().catch(()=>({}))).message||`判定に失敗しました: ${t.status} ${t.statusText}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function A(){const s=c.getToken();if(!s)return{success:!1,message:"認証されていません"};try{const e=await fetch("/api/v2/admin/award/templates/status",{method:"GET",headers:{Authorization:`Bearer ${s}`}});return e.status===401||e.status===403?(c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):e.ok?{success:!0,data:await e.json()}:{success:!1,message:`テンプレート状態の取得に失敗しました: ${e.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function $(s,e){const a=c.getToken();if(!a)return{success:!1,message:"認証されていません"};const t=new FormData;t.append("file",e);try{const r=await fetch(`/api/v2/admin/award/templates/${s}`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:t});if(r.status===401||r.status===403)return c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"};const n=await r.json();return r.ok?{success:!0,message:n.message||"テンプレートをアップロードしました"}:{success:!1,message:n.error||"アップロードに失敗しました"}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function j(){const s=c.getToken();if(!s)return{success:!1,message:"認証されていません"};try{const e=await fetch("/api/v2/admin/award/config",{method:"GET",headers:{Authorization:`Bearer ${s}`}});return e.status===401||e.status===403?(c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):e.ok?{success:!0,data:await e.json()}:{success:!1,message:`設定の取得に失敗しました: ${e.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function b(s){const e=c.getToken();if(!e)return{success:!1,message:"認証されていません"};try{const a=await fetch("/api/v2/admin/award/config",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.status===401||a.status===403)return c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"};const t=await a.json();return a.ok?{success:!0,data:t}:{success:!1,message:t.error||"設定の更新に失敗しました"}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}export{c as a,y as b,w as c,A as d,j as e,$ as f,T as g,b as h,S as j,v as r,p as s,k as u};
