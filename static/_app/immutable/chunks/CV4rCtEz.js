import{h as l}from"./CltlFA8S.js";import{w as f}from"./UMrgX0BC.js";function m(e,s,o){var t=e==null?"":""+e;return t===""?null:t}function p(e,s,o,t,r,a){var n=e.__className;if(l||n!==o||n===void 0){var u=m(o);(!l||u!==e.getAttribute("class"))&&(u==null?e.removeAttribute("class"):s?e.className=u:e.setAttribute("class",u)),e.__className=o}return a}function g(){const{subscribe:e,set:s,update:o}=f({token:null,email:null,isAuthenticated:!1,loading:!0});return{subscribe:e,init:()=>{const t=localStorage.getItem("authToken"),r=localStorage.getItem("authEmail");s(t?{token:t,email:r,isAuthenticated:!0,loading:!1}:{token:null,email:null,isAuthenticated:!1,loading:!1})},login:async(t,r)=>{try{const a=await fetch("/api/v2/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})});if(!a.ok)return{success:!1,error:"Invalid email or password"};const n=a.headers.get("Authorization");return n?(localStorage.setItem("authToken",n),localStorage.setItem("authEmail",t),s({token:n,email:t,isAuthenticated:!0,loading:!1}),{success:!0}):{success:!1,error:"No authorization token received"}}catch{return{success:!1,error:"Network error. Please try again."}}},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("authEmail"),s({token:null,email:null,isAuthenticated:!1,loading:!1})},getToken:()=>localStorage.getItem("authToken")}}const c=g();async function i(e,s){const o=c.getToken();if(!o)return{success:!1,message:"認証されていません"};const t=new FormData;t.append("file",s);try{const r=await fetch(e,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:t});if(r.status===401||r.status===403)return c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"};let a;try{a=await r.json()}catch{return r.ok?{success:!0,message:"アップロード成功！"}:{success:!1,message:`アップロードに失敗しました: ${r.status} ${r.statusText}`}}return a.success?{success:!0,message:a.message||`インポート完了: ${a.imported??0}件追加`,imported:a.imported,skipped:a.skipped}:{success:!1,message:a.message||"アップロードに失敗しました",code:a.code}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function k(e){return i("/api/v2/pota/import",e)}async function y(e){return i("/api/v2/sota/import/ja",e)}async function v(e){return i("/api/v2/locator/jcc-jcg/import",e)}async function w(){const e=c.getToken();if(!e)return{success:!1,message:"認証されていません"};try{const s=await fetch("/api/v2/admin/metrics",{method:"GET",headers:{Authorization:`Bearer ${e}`}});return s.status===401||s.status===403?(c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):s.ok?{success:!0,data:await s.json()}:{success:!1,message:`メトリクス取得に失敗しました: ${s.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function S(){const e=c.getToken();if(!e)return{success:!1,message:"認証されていません"};try{const s=await fetch("/api/v2/admin/restart",{method:"POST",headers:{Authorization:`Bearer ${e}`}});return s.status===401||s.status===403?(c.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):s.ok?{success:!0,message:"サーバーをリスタートしています..."}:{success:!1,message:`リスタートに失敗しました: ${s.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function T(e,s="strict"){const o=new FormData;o.append("file",e);try{const t=await fetch(`/api/v2/sota/award/10th-anniversary/judge?mode=${s}`,{method:"POST",body:o});return t.ok?{success:!0,result:await t.json()}:{success:!1,message:(await t.json().catch(()=>({}))).message||`判定に失敗しました: ${t.status} ${t.statusText}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}export{c as a,y as b,v as c,w as g,T as j,S as r,p as s,k as u};
