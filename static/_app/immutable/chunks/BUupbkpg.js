import{h as i}from"./CltlFA8S.js";import{w as f}from"./UMrgX0BC.js";function m(e,o,r){var t=e==null?"":""+e;return t===""?null:t}function p(e,o,r,t,a,s){var n=e.__className;if(i||n!==r||n===void 0){var c=m(r);(!i||c!==e.getAttribute("class"))&&(c==null?e.removeAttribute("class"):e.className=c),e.__className=r}return s}function d(){const{subscribe:e,set:o,update:r}=f({token:null,email:null,isAuthenticated:!1,loading:!0});return{subscribe:e,init:()=>{const t=localStorage.getItem("authToken"),a=localStorage.getItem("authEmail");o(t?{token:t,email:a,isAuthenticated:!0,loading:!1}:{token:null,email:null,isAuthenticated:!1,loading:!1})},login:async(t,a)=>{try{const s=await fetch("/api/v2/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:a})});if(!s.ok)return{success:!1,error:"Invalid email or password"};const n=s.headers.get("Authorization");return n?(localStorage.setItem("authToken",n),localStorage.setItem("authEmail",t),o({token:n,email:t,isAuthenticated:!0,loading:!1}),{success:!0}):{success:!1,error:"No authorization token received"}}catch{return{success:!1,error:"Network error. Please try again."}}},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("authEmail"),o({token:null,email:null,isAuthenticated:!1,loading:!1})},getToken:()=>localStorage.getItem("authToken")}}const l=d();async function u(e,o){const r=l.getToken();if(!r)return{success:!1,message:"認証されていません"};const t=new FormData;t.append("file",o);try{const a=await fetch(e,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t});if(a.status===401||a.status===403)return l.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"};let s;try{s=await a.json()}catch{return a.ok?{success:!0,message:"アップロード成功！"}:{success:!1,message:`アップロードに失敗しました: ${a.status} ${a.statusText}`}}return s.success?{success:!0,message:s.message||`インポート完了: ${s.imported??0}件追加`,imported:s.imported,skipped:s.skipped}:{success:!1,message:s.message||"アップロードに失敗しました",code:s.code}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function k(e){return u("/api/v2/pota/import",e)}async function y(e){return u("/api/v2/sota/import/ja",e)}async function v(e){return u("/api/v2/locator/jcc-jcg/import",e)}async function w(e,o="strict"){const r=new FormData;r.append("file",e);try{const t=await fetch(`/api/v2/sota/award/10th-anniversary/judge?mode=${o}`,{method:"POST",body:r});return t.ok?{success:!0,result:await t.json()}:{success:!1,message:(await t.json().catch(()=>({}))).message||`判定に失敗しました: ${t.status} ${t.statusText}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}export{l as a,y as b,v as c,w as j,p as s,k as u};
