import{h as i,ap as m,aq as d,ar as h,as as p,at as k,au as y}from"./BvU1om1O.js";import{w as v}from"./Bf6zgItq.js";function w(e,s,t){var a=e==null?"":""+e;return a===""?null:a}function b(e,s,t,a,r,o){var c=e.__className;if(i||c!==t||c===void 0){var u=w(t);(!i||u!==e.getAttribute("class"))&&(u==null?e.removeAttribute("class"):s?e.className=u:e.setAttribute("class",u)),e.__className=t}return o}const T=Symbol("is custom element"),_=Symbol("is html");function I(e){if(i){var s=!1,t=()=>{if(!s){if(s=!0,e.hasAttribute("value")){var a=e.value;l(e,"value",null),e.value=a}if(e.hasAttribute("checked")){var r=e.checked;l(e,"checked",null),e.checked=r}}};e.__on_r=t,m(t),d()}}function l(e,s,t,a){var r=S(e);i&&(r[s]=e.getAttribute(s),s==="src"||s==="srcset"||s==="href"&&e.nodeName==="LINK")||r[s]!==(r[s]=t)&&(s==="loading"&&(e[k]=t),t==null?e.removeAttribute(s):typeof t!="string"&&A(e).includes(s)?e[s]=t:e.setAttribute(s,t))}function S(e){return e.__attributes??={[T]:e.nodeName.includes("-"),[_]:e.namespaceURI===h}}var g=new Map;function A(e){var s=e.getAttribute("is")||e.nodeName,t=g.get(s);if(t)return t;g.set(s,t=[]);for(var a,r=e,o=Element.prototype;o!==r;){a=y(r);for(var c in a)a[c].set&&t.push(c);r=p(r)}return t}function $(){const{subscribe:e,set:s,update:t}=v({token:null,email:null,isAuthenticated:!1,loading:!0});return{subscribe:e,init:()=>{const a=localStorage.getItem("authToken"),r=localStorage.getItem("authEmail");s(a?{token:a,email:r,isAuthenticated:!0,loading:!1}:{token:null,email:null,isAuthenticated:!1,loading:!1})},login:async(a,r)=>{try{const o=await fetch("/api/v2/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:r})});if(!o.ok)return{success:!1,error:"Invalid email or password"};const c=o.headers.get("Authorization");return c?(localStorage.setItem("authToken",c),localStorage.setItem("authEmail",a),s({token:c,email:a,isAuthenticated:!0,loading:!1}),{success:!0}):{success:!1,error:"No authorization token received"}}catch{return{success:!1,error:"Network error. Please try again."}}},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("authEmail"),s({token:null,email:null,isAuthenticated:!1,loading:!1})},getToken:()=>localStorage.getItem("authToken")}}const n=$();async function f(e,s){const t=n.getToken();if(!t)return{success:!1,message:"認証されていません"};const a=new FormData;a.append("file",s);try{const r=await fetch(e,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:a});if(r.status===401||r.status===403)return n.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"};let o;try{o=await r.json()}catch{return r.ok?{success:!0,message:"アップロード成功！"}:{success:!1,message:`アップロードに失敗しました: ${r.status} ${r.statusText}`}}return o.success?{success:!0,message:o.message||`インポート完了: ${o.imported??0}件追加`,imported:o.imported,skipped:o.skipped}:{success:!1,message:o.message||"アップロードに失敗しました",code:o.code}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function E(e){return f("/api/v2/pota/import",e)}async function O(e){return f("/api/v2/sota/import/ja",e)}async function P(e){return f("/api/v2/locator/jcc-jcg/import",e)}async function z(){const e=n.getToken();if(!e)return{success:!1,message:"認証されていません"};try{const s=await fetch("/api/v2/admin/metrics",{method:"GET",headers:{Authorization:`Bearer ${e}`}});return s.status===401||s.status===403?(n.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):s.ok?{success:!0,data:await s.json()}:{success:!1,message:`メトリクス取得に失敗しました: ${s.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function D(){const e=n.getToken();if(!e)return{success:!1,message:"認証されていません"};try{const s=await fetch("/api/v2/admin/restart",{method:"POST",headers:{Authorization:`Bearer ${e}`}});return s.status===401||s.status===403?(n.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):s.ok?{success:!0,message:"サーバーをリスタートしています..."}:{success:!1,message:`リスタートに失敗しました: ${s.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function B(e,s="strict"){const t=new FormData;t.append("file",e);try{const a=await fetch(`/api/v2/sota/award/10th-anniversary/judge?mode=${s}`,{method:"POST",body:t});return a.ok?{success:!0,result:await a.json()}:{success:!1,message:(await a.json().catch(()=>({}))).message||`判定に失敗しました: ${a.status} ${a.statusText}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}function M(e,s,t){return`/api/v2/sota/award/10th-anniversary/certificate?${new URLSearchParams({callsign:e,award_type:s,summits:t.toString()}).toString()}`}async function C(){const e=n.getToken();if(!e)return{success:!1,message:"認証されていません"};try{const s=await fetch("/api/v2/admin/award/templates/status",{method:"GET",headers:{Authorization:`Bearer ${e}`}});return s.status===401||s.status===403?(n.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):s.ok?{success:!0,data:await s.json()}:{success:!1,message:`テンプレート状態の取得に失敗しました: ${s.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function L(e,s){const t=n.getToken();if(!t)return{success:!1,message:"認証されていません"};const a=new FormData;a.append("file",s);try{const r=await fetch(`/api/v2/admin/award/templates/${e}`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:a});if(r.status===401||r.status===403)return n.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"};const o=await r.json();return r.ok?{success:!0,message:o.message||"テンプレートをアップロードしました"}:{success:!1,message:o.error||"アップロードに失敗しました"}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function J(){const e=n.getToken();if(!e)return{success:!1,message:"認証されていません"};try{const s=await fetch("/api/v2/admin/award/config",{method:"GET",headers:{Authorization:`Bearer ${e}`}});return s.status===401||s.status===403?(n.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"}):s.ok?{success:!0,data:await s.json()}:{success:!1,message:`設定の取得に失敗しました: ${s.status}`}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}async function F(e){const s=n.getToken();if(!s)return{success:!1,message:"認証されていません"};try{const t=await fetch("/api/v2/admin/award/config",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===401||t.status===403)return n.logout(),{success:!1,message:"セッションが期限切れです。再度ログインしてください。"};const a=await t.json();return t.ok?{success:!0,data:a}:{success:!1,message:a.error||"設定の更新に失敗しました"}}catch{return{success:!1,message:"ネットワークエラー。再試行してください。"}}}export{l as a,n as b,O as c,P as d,z as e,C as f,M as g,J as h,L as i,B as j,F as k,D as l,I as r,b as s,E as u};
