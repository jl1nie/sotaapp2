<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload</title>
</head>

<body>
    <h4>Import SOTA Summits list </h4>
    <form id="import-summit" method="post" enctype="multipart/form-data">
        <input id="import-summit-file" type="file" name="file">
        <button id="import-summit-button" type="submit">Upload</button>
    </form>

    <h4>Update SOTA Summits list </h4>
    <form id="import-activation" method="post" enctype="multipart/form-data">
        <input id="import-activation-file" type="file" name="file">
        <button id="import-activation-button" type="submit">Upload</button>
    </form>

    <h4>Import SOTA JA Summits list </h4>
    <form id="upload-ja-summit" method="post" enctype="multipart/form-data">
        <input id="upload-ja-summit-file" type="file" name="file">
        <button id="upload-ja-summit-button" type="submit">Upload</button>
    </form>

    <h4>Import POTA Park list </h4>
    <form id="upload-pota" method="post" enctype="multipart/form-data">
        <input id="upload-pota-file" type="file" name="file">
        <button id="upload-pota-button" type="submit">Upload</button>
    </form>

    <h4>Upload POTA Activator Log </h4>
    <form id="upload-activator" method="post" enctype="multipart/form-data">
        <input id="upload-activator-file" type="file" name="file">
        <button id="upload-activator-button" type="submit">Upload</button>
    </form>

    <h4>Upload POTA Hunter Log </h4>
    <form id="upload-hunter" method="post" enctype="multipart/form-data">
        <input id="upload-hunter-file" type="file" name="file">
        <button id="upload-hunter-button" type="submit">Upload</button>
    </form>


    <h4>Import JCC-JCG list </h4>
    <form id="upload-jcc" method="post" enctype="multipart/form-data">
        <input id="upload-jcc-file" type="file" name="file">
        <button id="upload-jcc-button" type="submit">Upload</button>
    </form>

    <h4>Reference list</h4>
    <form id="reflist" method="get">
        <label for="prog-reflist">Program:</label>
        <select id="prog-reflist" name="prog-refid">
            <option value="SOTA">SOTA</option>
            <option value="POTA">POTA</option>
        </select><br><br>
        <label for="reflist-limit">Limit:</label>
        <input type="text" id="reflist-limit" name="reflist-limit" value="10"><br><br>
        <label for="reflist-offset">Offset:</label>
        <input type="text" id="reflist-offset" name="reflist-offset" value="0"><br><br>

        <input type="submit" value="送信">
    </form>

    <h4>Search by Ref_id</h4>
    <form id="search-refid" method="get">
        <label for="prog-refid">Program:</label>
        <select id="prog-refid" name="prog-refid">
            <option value="SOTA">SOTA</option>
            <option value="POTA">POTA</option>
        </select><br><br>
        <label for="ref_id">Reference:</label>
        <input type="text" id="ref_id" name="ref_id"><br><br>
        <input type="submit" value="送信">
    </form>

    <h4>Search Location</h4>
    <form id="search-location" method="get">
        <label for="min_lon">Min Lon:</label>
        <input type="text" id="min_lon" name="min_lon" value="138.860"><br><br>

        <label for="min_lat">Min Lat:</label>
        <input type="text" id="min_lat" name="min_lat" value="35.3726"><br><br>

        <label for="max_lon">Max Lon:</label>
        <input type="text" id="max_lon" name="max_lon" value="139.7213"><br><br>

        <label for="max_lat">Max Lat:</label>
        <input type="text" id="max_lat" name="max_lat" value="35.7480"><br><br>

        <label for="min_elev">Min Elev:</label>
        <input type="text" id="min_elev" name="min_elev" value="1500"><br><br>

        <label for="max_results">Max Results:</label>
        <input type="text" id="max_results" name="max_results" value="500"><br><br>

        <input type="submit" value="送信">
    </form>

    <h4>Alerts</h4>
    <form id="alerts" method="get">
        <label for="prog-alerts">Program:</label>
        <select id="prog-alerts" name="prog-alerts">
            <option value="SOTA">SOTA</option>
            <option value="POTA">POTA</option>
        </select><br><br>
        <label for="after">Show alerts in :</label>
        <input type="text" id="alerts-after" name="after" value="1"><br><br>
        <input type="submit" value="送信">
    </form>

    <h4>Spots</h4>
    <form id="spots" method="get">
        <label for="prog-spots">Program:</label>
        <select id="prog-spots" name="prog-spots">
            <option value="SOTA">SOTA</option>
            <option value="POTA">POTA</option>
        </select><br><br>
        <label for="after">Show spots in :</label>
        <input type="text" id="spots-after" name="after" value="1"><br><br>

        <input type="submit" value="送信">
    </form>

    <h4>Search JCC/JCG by MuniCd</h4>
    <form id="search-jcc" method="get">
        <label for="lon">Lon:</label>
        <input type="text" id="lon" name="lon" value="138.9439"><br><br>
        <label for="lat">Lat:</label>
        <input type="text" id="lat" name="lat" value="35.8555"><br><br>
        <label for="ref_id">MuniCd:</label>
        <input type="text" id="municd" name="municd" value="13308"><br><br>
        <input type="submit" value="送信">
    </form>

    <h4>Latest Ap/Kp Index</h4>
    <form id="geomag" method="get">
        <input type="submit" value="送信">
    </form>

    <h4>Search Name</h4>
    <form id="search-name" method="get">
        <label for="name">Name:</label>
        <input type="text" id="name-field" name="name"><br><br>

        <label for="limit">Limit:</label>
        <input type="text" id="limit" name="limit" value="10"><br><br>
    </form>

    <h4>JSON Result</h4>
    <div id="result"></div>

    <script>
        const url = new URL(document.documentURI);
        const baseurl = `${url.protocol}//${url.host}/api/v2`;
        const uid = "538b548f-12db-4230-b48d-46d8842b2da9"
        const sotasearch = baseurl + '/sota/summit';
        const sotalist = baseurl + '/sota/summit-list';
        const sotaalert = baseurl + '/sota/alerts';
        const sotaspot = baseurl + '/sota/spots';
        const importsota = baseurl + '/sota/import';
        const importactivation = baseurl + '/sota/update';
        const importsotaja = baseurl + '/sota/import/ja';

        const potasearch = baseurl + '/pota/park';
        const potalist = baseurl + '/pota/park-list';
        const potaalert = baseurl + '/pota/alerts';
        const potaspot = baseurl + '/pota/spots';
        const importpota = baseurl + '/pota/import';
        const uploadactivator = baseurl + '/pota/upload/activator';
        const uploadhunter = baseurl + '/pota/upload/hunter';
        const locatejcc = baseurl + '/locator/jcc-jcg';
        const importjcc = baseurl + '/locator/jcc-jcg/import';
        const mapcode = baseurl + '/locator/mapcode';
        const geomag = baseurl + '/propagation/geomag';
        const searchurl = baseurl + '/search';
        const searchbreif = baseurl + '/search/brief';

        function uploadFile(url, inputid, buttonid) {
            event.preventDefault(); // フォームのデフォルトの送信動作を防ぐ 
            const fileInput = document.getElementById(inputid);
            const button = document.getElementById(buttonid);
            const resultDiv = document.getElementById('result');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            button.disabled = true;

            fetch(url, { method: 'POST', body: formData })
                .then(response => {
                    if (response.ok) {
                        console.log('Success:', response.status);
                        resultDiv.textContent = 'Upload done: ' + response.status;
                    } else {
                        console.error('Error:', response.status);
                        resultDiv.textContent = 'Error: ' + response.status;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    resultDiv.textContent = 'Error: ' + response.status;
                })
                .finally(() => {
                    button.disabled = false;
                })
        };

        function search(baseurl, param) {
            event.preventDefault(); // フォームのデフォルトの送信動作を防ぐ 

            let fullurl = baseurl;
            if (param != '') {
                fullurl += `?${param}`;
            }

            const resultDiv = document.getElementById('result');
            fetch(fullurl)
                .then(response => {
                    if (response.ok) { return response.json(); }
                    else if (response.status === 404) { throw new Error('404 Not Found'); }
                    else { throw new Error('Network response was not ok'); }
                })
                .then(data => {
                    console.log('Success:', data);
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    console.error('Error:', error);
                    resultDiv.textContent = 'Error: ' + error;
                });
        };

        document.getElementById('import-summit')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                uploadFile(importsota, 'import-summit-file', 'import-summit-button');
            });

        document.getElementById('import-activation')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                uploadFile(importactivation, 'import-activation-file', 'import-activation-button');
            });

        document.getElementById('upload-ja-summit')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                uploadFile(importsotaja, 'upload-ja-summit-file', 'upload-ja-summit-button');
            });

        document.getElementById('upload-pota')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                uploadFile(importpota, 'upload-pota-file', 'upload-pota-button');
            });

        document.getElementById('upload-activator')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let eid = encodeURIComponent(uid);
                uploadFile(uploadactivator + `/${eid}`, 'upload-activator-file', 'upload-activator-button');
            });

        document.getElementById('upload-hunter')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let eid = encodeURIComponent(uid);
                uploadFile(uploadhunter + `/${eid}`, 'upload-hunter-file', 'upload-hunter-button');
            });

        document.getElementById('upload-jcc')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                uploadFile(importjcc, 'upload-jcc-file', 'upload-jcc-button');
            });

        document.getElementById('reflist')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let limit = document.getElementById('reflist-limit').value;
                let offset = document.getElementById('reflist-offset').value;
                let param = `limit=${limit}&offset=${offset}`;
                let prog = document.getElementById('prog-reflist').value;
                if (prog === 'SOTA') {
                    search(sotalist, param);
                } else if (prog === 'POTA') {
                    search(potalist, param);
                }
            });

        document.getElementById('search-refid')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let id = document.getElementById('ref_id').value;
                let eid = encodeURIComponent(id);
                let prog = document.getElementById('prog-refid').value;
                if (prog === 'SOTA') {
                    let url = sotasearch + `/${eid}`;
                    search(url, '');
                } else if (prog === 'POTA') {
                    let url = potasearch + `/${eid}`;
                    search(url, '');
                }
            });

        document.getElementById('search-jcc')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let muni = document.getElementById('municd').value;
                let lon = document.getElementById('lon').value;
                let lat = document.getElementById('lat').value;
                let param = `lon=${lon}&lat=${lat}&muni_code=${muni}`;
                search(locatejcc, param);
            });

        document.getElementById('geomag')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                search(geomag, '');
            });

        document.getElementById('name-field')
            .addEventListener('input', function (event) {
                event.preventDefault();
                let name = document.getElementById('name-field').value;
                let limit = document.getElementById('limit').value;
                let param = `name=${name}&max_count=${limit}`;
                if (name.length > 2) {
                    search(searchbreif, param)
                }
            });

        document.getElementById('search-location')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let min_lon = document.getElementById('min_lon').value;
                let min_lat = document.getElementById('min_lat').value;
                let max_lon = document.getElementById('max_lon').value;
                let max_lat = document.getElementById('max_lat').value;
                let min_elev = document.getElementById('min_elev').value;
                let max_results = document.getElementById('max_results').value;
                let eid = encodeURIComponent(uid);
                let param = `user_id=${eid}&min_lon=${min_lon}&min_lat=${min_lat}&max_lon=${max_lon}&max_lat=${max_lat}&min_elev=${min_elev}&max_results=${max_results}`;
                search(searchurl, param);
            });

        document.getElementById('alerts')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let after = document.getElementById('alerts-after').value;
                let param = `after=${after}`;
                let prog = document.getElementById('prog-alerts').value;
                if (prog === 'SOTA') {
                    let alertsurl = sotaalert;
                    search(alertsurl, param);
                } else if (prog === 'POTA') {
                    let alertsurl = potaalert;
                    search(alertsurl, param);
                }

            });

        document.getElementById('spots')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let after = document.getElementById('spots-after').value;
                let param = `after=${after}`;
                let prog = document.getElementById('prog-spots').value;
                if (prog === 'SOTA') {
                    let spotsurl = sotaspot;
                    search(spotsurl, param);
                } else if (prog === 'POTA') {
                    let spotsurl = potaspot;
                    search(spotsurl, param);
                }

            });

    </script>
</body>